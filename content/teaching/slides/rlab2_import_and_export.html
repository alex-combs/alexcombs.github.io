<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>PADP 7120 Data Applications in PA</title>
    <meta charset="utf-8" />
    <meta name="author" content="Alex Combs" />
    <meta name="date" content="2020-08-29" />
    <link rel="stylesheet" href="mypres.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# PADP 7120 Data Applications in PA
## RLab 2: Importing &amp; Exporting Data &amp; Documents
### Alex Combs
### UGA/SPIA/PADP
### 2020-08-29

---

# Objectives

By the end of this lab, you will have learned how to...

- use data included in a R package
- import data of different common formats
- import data from a url
- control what the reader of your document actually sees
- export work to Word and PDF
- export data to a few common formats

---
# Start a new project

- Let's start a new project using a slightly different process than we learned last week
- We will create a new project from an *existing* directory (a folder already on your computer)

--

- Using the file directory on your computer
  - Go to the parent folder that contains your RLab1 folder
  - Create a new folder named RLab2

--

- In RStudio
  - Create new project
  - Select Existing Directory
  - Click Browse and select the RLab2 folder you just created
  - Click Create Project
  
---
# Start a R notebook

- Use the dropdown menu in the upper-left of RStudio to start a notebook
- Let's make some minimal changes to the YAML header
  - Change the title to "RLab2: Import &amp; Export Data &amp; Docs"
  - Change the output to `html_document`

--

- Delete all of the content included in the template

---
# Loading RData file review

- We learned how to load data files already formatted for R

- Load the "states1.RData" file from the previous lab

--

If file is in your RLab2 project folder:


```r
load("states1.RData")
```

If you want to keep file in RLab1 folder:


```r
load("../RLab1/states1.RData")
```

The `..` tells R to look in whatever your parent directory containing RLab1

---
# Using data included in a R package

- R loads with some play data sets that are useful for learning. For example, run the following code


```r
mtcars
```

--

- Many R packages include data
- Try loading the following packages.


```r
library(gapminder)
library(fivethirtyeight)
```

---
# Using data included in a R package

- You probably got an error that the packages are not installed.

--

- Run the following code in your console. 


```r
install.packages("gapminder")
install.packages("fivethirtyeight")
# OR
install.packages(c("gapminder", "fivethirtyeight"))
```

--
- Remember why not to install in your notebook?

- Now rerun the code that *loads* these packages

---
# Using data included in a R package

- Run the following code


```r
gapminder
```

- This dataset is too large for knitting document

--

- Add the following to the above code


```r
head(gapminder, n=4)
```

---
# Using data included in a R package

- Save as object by changing to below; latter option prints object too


```r
babygap &lt;- head(gapminder, n=4)

(babygap &lt;- head(gapminder, n=4))
```

- Let's also add another object from `fivethirtyeight` data


```r
hc &lt;- hate_crimes
```

- Then print the object in a separate code chunk


```r
hc
```

---
class: inverse, middle, center

# Let's pause learning data imports and learn how to control what gets exported for our audience to read

---
# WYSIWYG

- What you see is what you get
- This is how software like Word and Excel work

--

- R is not WYSIWYG
- You can control what you see in your notebook and what it exports for others to read

---
class: inverse, middle, center

# For example, throughout this presentation I have been showing you code but no results. In fact, R didn't even execute the code I've been showing you.

---
# Common motivations for controlling what exports

- Run code but don't show code or tell results
  - I need to load some packages and/or data but my audience doesn't need anything related to that
  - Suppress all code and output
  
- Run code and tell results but don't show code
  - I want to present some results to my audience but not show them the code used to produce it
  - Suppress code
  
- You will encounter these two many times

---
# Common motivations for controlling what exports

- Run code and show code but don't tell results
  - I want to explain to my audience the code I used but they don't need to see the results that I need for something to work later
  - Suppress results
  
- Show code but don't run code
  - I want to teach my audience some code but I don't need to run it for anything to work later

---
# Run code but don't show or tell

- Knit your current notebook to HTML; save as `rlab2_lastname`

--

- Our document includes the entire mtcars data set. Rarely a good idea.

- We still want to be able to look at and interact with the data in our notebook.

- Change the very top line of the code chunk containing `mtcars` to:


```r
{r, include=FALSE}
```

- Knit to HTML again, there should be no sign of the mtcars data

---
# Run code but don't show or tell

- We usually don't need to show the code used to load data and packages or any of the output loading produces

- Suppress the code and output for the code chunks that loaded `states1` data as well as the `gapminder` and `fivethirtyeight` packages

- Knit to HTML again

---
# Run code and tell results but don't show

- We have the first four rows of the `gapminder` data set. A nice preview of data for our reader.

- They don't need to see the code that produced it.

- Change the top line of the code chunk to:


```r
{r, echo=FALSE}
```

- Knit to HTML again, notice the code is gone but the table remains

---
# Run and show code but don't tell results

- Instead, suppose we wanted to run the code, explain the code to our audience, but didn't want to provide the table.

- Change the top line from `echo=FALSE` to:


```r
{r, results='hide'}
```

- Knit to HTML. Note that we see the code but not the table.

- Change back to `echo=FALSE`

---
# Show code but don't run code at all

- We have the hate_crimes data set printed in our document. No good.

- Suppose we simply wanted to provide this code for instruction but didn't want to run it.

- Change the top line of the code chunk containing `hc &lt;- hate_crimes` to:


```r
{r, eval=FALSE}
```

- Do not change the code chunk containing `hc`

- Knit to HTML

--

- What did we do wrong?

---
# Output options recap

![](labs_files/output_options.png)

---
class: inverse, center, middle

# Back to data imports

---
# Importing common data files into R

- Data rarely come formatted for R as a RData file

- Two very common file types are
  - Comma separated files (CSV)
  - Excel files (XLS or XLSX)

--
  
- Consider
  - Do I want to create a RData file that I can load in my notebook, discarding the original file?
  - Do I want to keep the original file and import into R using code that runs each time I knit my notebook?
  - Do the original data update frequently?
  

---
# Creating a RData file to load

- In the menu bar, go to File -&gt; Import Dataset -&gt; File type
  - If CSV file, choose Text (readr)

- To save any dataset as a .RData file


```r
save(name_of_dataset_in_environment, file = "filename.RData")
```

- Then we can load this dataset as needed like we've done before 


```r
load("filename.RData")
```

- Let's try this with a new file available on eLC called `ncbirths.csv`

---
# Import from original file using code

- Maybe I don't want to create a .RData file

- To import CSV, we need to load `tidyverse`


```r
library(tidyverse)
```

- To import Excel, we need to load `readxl`


```r
library(readxl)
```

- Suppress this code and any output

---
# Import original file using code

- If we plan to use `ncbirths` in our notebook, we have to include the import in our notebook.

- To import CSV, we use the following code


```r
name_for_new_object &lt;- read_csv("filename.csv")
```

- Try this with `ncbirths.csv`. Suppress code and output.

---
# Import from original file using code

- Common to find data that is not neatly organized

- Importing with code can avoid modifying the original file. 

- We want to make the import as self-contained as possible.

--

- To see what kind of options we can use, let's check out the help file

- Go to the Help tab in your Files pane and search for read_excel

---
# Import from original file using code

- Let's try to import a file that is poorly formatted, ga_schdist_raw.xlsx

- First, open it in Excel to see what we are dealing with

--

- A useful approach is to tell R the range of cells to import

- The following code defines the range of cells; the first row is read as variable names by default

- Add to your notebook. Suppress code and output.


```r
ga_schdist_raw &lt;- read_xlsx("ga_schdist_raw.xlsx", 
                            range = "A7:I231")
```

(We shouldn't import row 231 but doing so deliberately to show something else later)

---
# Checking our import

- We can click on the object `ga_schdist_raw` to see it in spreadsheet format

- Another quick way to examine a dataset is `glimpse`. Run the following code:


```r
glimpse(ga_schdist_raw)
```

- These data are a bit of a mess. We could include `col_types` and `col_names` in the import, but we will won't here so we can use it for RLab3.

- Save these data as an .RData file to use next week. Suppress code and output.

---
# Import from URL

- What if the data I use changes/updates often? I don't want to have to download a new version every time.

- What if the data I use is publicly available in a central location and is really large? I don't want to have to save it to my computer.

--

- Lots of data are saved to the web and accessible via a url. We can import directly from the url.

- We need another package to import via url


```r
library(data.table)
```

- Which allows us to use the function:


```r
name_for_new_object &lt;- fread('url')
```

---
# Import from URL

[Coronavirus case count](https://www.nytimes.com/interactive/2020/us/coronavirus-us-cases.html)

- New York Times made the data publicly available on GitHub

[Data repository](https://github.com/nytimes/covid-19-data)

- The url for the raw state-level data is [here](https://raw.githubusercontent.com/nytimes/covid-19-data/master/us.csv)

- We can import these data from the web by running the following code:


```r
covid &lt;- fread('https://raw.githubusercontent.com/nytimes/covid-19-data/master/us.csv')
```

- Add `eval=FALSE` to the above chunk so it doesn't run every time we knit

---
class: inverse, center, middle

# Exporting to documents other than HTML (Word and PDF)

---
# Knit to Word

- First, let's add a few headers for organization

  - Above the `babygap` code chunk, add "Gapminder Data"
  - Above `ga_schdist_raw` import, add "Georgia School Data"

--

- If Word is on your computer, knitting to Word should just work

- In the Knit dropdown menu, select 'Knit to Word'

- Formatting will probably be an issue; change font and spacing in Word after you get the main content on the page from R

---
# Nicer Table

- Let's make that gapminder table look better

- Add second-level header "Nicer Table" and add another code chunk


```r
kable(babygap)
```


- If you get an error, you forgot to do something we learned last week

---
# Knit to PDF

- In order to knit to PDF, your computer needs a copy of LaTeX

- You can install a light version of LaTeX within RStudio. Run the following code **in your console**.


```r
# First
install.packages('tinytex') # hit Enter
# Next
tinytex::install_tinytex() # hit Enter, this will take a few minutes
# if you ever need to uninstall TinyTeX, run tinytex::uninstall_tinytex()
```

- Try to Knit to PDF. If it works, there is nothing else you need to know or do. You will be able to knit to PDF moving forward.

- You should have a PDF document in your project folder.

---
class: inverse, center, middle

# Finally, let's learn how to export data in R to CSV

---
# Export data to CSV

- We may want to export an object to csv for non-R-users to open

- To export to csv:

```r
write_csv(name_of_object, 
          file = 'name_for_new_file.csv')
```

--

- Export the `babygap` object to a csv file. Suppress code and output.

---
# Recap

- Over past two weeks...

- Launch R -&gt; load data &amp; packages needed to do analysis -&gt; knit to document -&gt; save documents and data for later use

--

  - Import .RData, .csv, Excel, and urls

  - Export analysis to HTML, Work, PDF

  - Control/format what your reader sees in a way that is actually useful

  - Export any new data to .csv for anyone else to use with other software

--

- This pretty much covers everything you need to realistically use R

- Now we proceed to actually working with data and conducting analysis

---
# Upload to eLC

- Knit to HTML

- Upload your notebook (.Rmd) and output (.html) to the RLabs assignment dropbox on eLC.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>

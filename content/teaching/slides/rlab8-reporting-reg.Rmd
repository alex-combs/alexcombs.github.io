---
title: "PADP 7120 Data Applications in PA"
subtitle: "RLab 8: Reporting Regression Results"
author: "Alex Combs"
institute: "UGA | SPIA | PADP"
date: "Last updated: `r format(Sys.time(), '%B %d, %Y')`"
output:
  xaringan::moon_reader:
    css: 'mypres.css'
    nature:
      beforeInit: "macros.js"
      highlightStyle: github
      countIncrementalSlides: false
      highlightLines: true
---
# Outline

- Report regression results using tables and graphs in a more realistic and professional way

- This lab involves a lot of copying-and-pasting of code. You want to have these slides open on your computer. 

```{r, include=FALSE}
library(tidyverse)
library(moderndive)
library(knitr)
library(fivethirtyeight)
library(carData)
library(stargazer) # for regression tables
library(jtools) # for regression visualizations
library(interactions) # for regression viz of interactions
library(rockchalk)
```

---
# Setup

> **Start a new project and Rmd**

> **Change YAML.**

```{r, eval=FALSE}
---
title: "RLab 8: Reporting Regression Results"
author: "Your Name"
output: 
  html_document:
    theme: spacelab
    df_print: paged
---
```

---
# Setup

> **In setup code chunk, load following packages**

```{r, eval=FALSE}
library(tidyverse)
library(moderndive)
library(knitr)
library(fivethirtyeight)
library(carData)
library(stargazer) # for better regression tables
library(jtools) # for better regression visualizations
library(interactions) # for regression viz with interactions
```

---
# Setup

> **Add below code to setup code chunk**

```{r, warning=FALSE, message=FALSE}
state_data <- hate_crimes %>%
  filter(state != "District of Columbia") %>%
  mutate(urbanization = if_else(share_pop_metro<=0.75, "low", "high")) %>% 
  select(state, 
         median_house_inc, 
         share_pop_hs, 
         urbanization) %>%
  mutate(share_pop_hs = share_pop_hs*100)
```

---
# Setup

> **Download "teacher_ratings.csv" from eLC. Import data in your setup code chunk.**

```{r, eval=FALSE}
teacher_ratings <- read_csv("teacher_ratings.csv")
```

---
# Revisiting PS3 Regression

$$MedInc = \beta_0 + \beta_1 \%HS + \beta_2Urban + \epsilon$$

> **Add and run following code in a new code chunk**

```{r}
inc_mod <- lm(median_house_inc ~ share_pop_hs + urbanization, data = state_data)
```

---
# Reporting Results

- We have learned how to produce a standard table of results using `get_regression_table`

```{r, echo=FALSE}
get_regression_table(inc_mod) %>% 
  kable()
```

- This table is fine but not typically how results are presented

---
# Better Regression Tables

- Regression results tables usually include:
  - estimate
  - standard error or t-statistic; rarely both
  - stars to indicate statistical significance based on p-value
  - clear variable names
  - number of observations

- Sometimes goodness-of-fit measure like $R^2$  
- Sometimes include confidence intervals instead of standard error

---
# Better Regression Tables

> **In a new code chunk, add below code. Include the code chunk option `results='asis'`. Knit to HTML.**

```{r, eval=FALSE}
stargazer(inc_mod,
          type="html",
          title="Regression Results",
          dep.var.labels=c("Median Household Income"),
          covariate.labels=c("Percent High School", 
                             "Low Urbanization"),
          keep.stat=c("n"), # reports number of observations
          digits = 0, # sets the number of decimals to report
          digits.extra = 3) # number of decimals if rounding results in 0
```

---
# Better Regression Tables

> **Change options to include confidence intervals instead of standard errors and include goodness-of-fit. Knit to HTML.**

```{r, eval=FALSE}
stargazer(inc_mod, 
          ci=TRUE, ci.separator = " : ", #<<
          type="html",
          title="Regression Results",
          dep.var.labels=c("Median Household Income"),
          covariate.labels=c("Percent High School", 
                             "Low Urbanization"),
          keep.stat=c("n","rsq","ser"), #<<
          digits = 0,
          digits.extra = 3)
```

---
# Better Regression Tables

> **Add the last line below. Knit to HTML.**

```{r, eval=FALSE}
stargazer(inc_mod, ci=TRUE, ci.separator = " : ",
          type="html",
          title="Regression Results",
          dep.var.labels=c("Median Household Income"),
          covariate.labels=c("Percent High School", 
                             "Low Urbanization"),
          keep.stat=c("n","rsq","ser"),
          digits = 0,
          digits.extra = 3,
          out = "inc_mod.htm") #<<
```

- This will generate a new document named `inc_mod.htm` that you can open in Word.

---
class: inverse, center, middle

# For presentations, we may want to use graphs instead of tables.

---
# Visualizing Regression

- One option is to use `ggplot`

.pull-left[
```{r, eval=FALSE}
ggplot(state_data, 
       aes(x = share_pop_hs, 
           y = median_house_inc, 
           color = urbanization)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_minimal() +
  theme(title = element_text(size = 16),
        axis.text = element_text(size = 12))
```
]

.pull-right[
```{r, echo=FALSE, message=FALSE, out.width='99%'}
ggplot(state_data, 
       aes(x = share_pop_hs, 
           y = median_house_inc, 
           color = urbanization)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE) +
  theme_minimal() +
  theme(title = element_text(size = 16),
        axis.text = element_text(size = 12))
```
]

---
# Visualizing Regression Line

- `ggplot` can visualize regression models that include:

  - **ONE** numerical explanatory variable
  - **ONE** categorical explanatory variable (with or without interaction)

--

- If we controlled for one more numerical variable, our `ggplot` graph would not show the relationship between income and percent high school **controlling for the other variable**

---
# Revisiting Teacher Evals

$$Eval = \beta_0 + \beta_1Beauty + \beta_2Age \\ +\beta_3Female + \beta_4Beauty \times Female + \epsilon$$
```{r, include=FALSE}
load("labs_files/teach_beauty.RData")
```

> **In a new code chunk, add and run the below code.**

```{r, eval=FALSE}
mod1 <- lm(course_eval ~ beauty, data = teacher_ratings)
mod2 <- lm(course_eval ~ beauty + age + female, data = teacher_ratings)
mod3 <- lm(course_eval ~ beauty + age + female + beauty*female, data = teacher_ratings)
```

```{r, echo=FALSE}
mod1 <- lm(course_eval ~ beauty, data = all_data)
mod2 <- lm(course_eval ~ beauty + age + female, data = all_data)
mod3 <- lm(course_eval ~ beauty + age + female + beauty*female, data = all_data)
```

---
# Visualizing Regression

```{r, echo=FALSE}
get_regression_table(mod3) %>% 
  kable()
```

- We can't visualize the relationship between ratings and beauty controlling for age using `ggplot`

---
# Visualizing Regression

- `effect_plot` from the `jtools` package can

> **Add below code in a new code chunk**

```{r, fig.align='center', fig.height=5}
effect_plot(mod3, pred = beauty, plot.points = TRUE)
```

---
# Visualizing Regression Line

- To include Female, `interact_plot` from `interactions` package 

> **In a new code chunk, add below code**

```{r, fig.align='center', fig.height=5, warning=FALSE}
interact_plot(mod3, pred = beauty, modx = female, plot.points = TRUE)
```

---
# Visualizing Coefficients

- May want to visualize the estimates instead of using a table or regression lines. 

> **Add following code in a new code chunk.**


```{r, eval=FALSE}
plot_summs(mod3, 
           coefs = c("Beauty" = "beauty", 
                     "Age" = "age", 
                     "Female" = "female",
                     "Beauty X Female" = "beauty:female"))
```



---
# Multiple models in same table

> **Add below code in a new code chunk. Include `results='asis'` option.**

```{r, eval=FALSE}
stargazer(mod1, mod2, mod3, #<<
          ci = TRUE, ci.separator = " : ",
          type="html",
          title="Regression Results",
          dep.var.labels=c("Course evaluation score"),
          covariate.labels=c("Professor beauty", 
                             "Professor age", 
                             "Professor female",
                             "Beauty X Female"),
          keep.stat=c("n","adj.rsq","ser"),
          digits = 2,
          notes = "95% confidence intervals in parentheses.",
          notes.align = "l")
```

---
# Multiple models

> **Add below code in a new code chunk**

```{r, eval=FALSE}
plot_summs(mod1, mod2, 
           coefs = c("Beauty" = "beauty", 
                     "Age" = "age", 
                     "Female" = "female"))
```

> **Knit to HTML. Let's examine what all this code did.**

> **Upload your Rmd to eLC**

